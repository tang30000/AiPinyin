<!DOCTYPE html>
<html lang="zh" class="dark">

<head>
    <meta charset="UTF-8">
    <title>AiPinyin è®¾ç½®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        surface: '#1a1b26',
                        card: '#24283b',
                        border: '#292e42',
                        muted: '#565f89',
                        accent: '#7aa2f7',
                        purple: '#bb9af7',
                        green: '#9ece6a',
                        red: '#f7768e',
                    }
                }
            }
        }
    </script>
    <style>
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch {
            border: 1px solid #3b4261;
            border-radius: 6px;
        }
    </style>
</head>

<body class="bg-surface text-slate-300 min-h-screen p-6 select-none">
    <h1 class="text-xl font-bold text-accent mb-5">âš™ AiPinyin è®¾ç½®</h1>

    <!-- å¤–è§‚ -->
    <h2 class="text-sm font-semibold text-purple bg-card rounded-lg px-3 py-1.5 mb-2 mt-4">ğŸ¨ å¤–è§‚</h2>
    <div class="space-y-0 divide-y divide-border">
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">ä¸­æ–‡å€™é€‰å­—å·</span>
            <input type="number" id="fontSize" min="12" max="36" value="24"
                class="w-16 bg-surface border border-border rounded-md px-2 py-1 text-center text-sm text-slate-300">
            <span class="text-xs text-muted w-6 text-right">px</span>
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">æ‹¼éŸ³å­—å·</span>
            <input type="number" id="pinyinSize" min="10" max="28" value="18"
                class="w-16 bg-surface border border-border rounded-md px-2 py-1 text-center text-sm text-slate-300">
            <span class="text-xs text-muted w-6 text-right">px</span>
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">çª—å£åœ†è§’</span>
            <input type="number" id="cornerRadius" min="0" max="24" value="14"
                class="w-16 bg-surface border border-border rounded-md px-2 py-1 text-center text-sm text-slate-300">
            <span class="text-xs text-muted w-6 text-right">px</span>
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">é€æ˜åº¦</span>
            <input type="range" id="opacity" min="100" max="255" value="240" class="w-28 accent-accent">
            <span class="text-xs text-muted w-6 text-right" id="opacityVal">240</span>
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">èƒŒæ™¯è‰²</span>
            <input type="color" id="bgColor" value="#2E313E" class="w-8 h-7 rounded cursor-pointer bg-transparent">
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">å€™é€‰æ–‡å­—è‰²</span>
            <input type="color" id="textColor" value="#C8CCD8" class="w-8 h-7 rounded cursor-pointer bg-transparent">
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">æ‹¼éŸ³é¢œè‰²</span>
            <input type="color" id="pinyinColor" value="#A9B1D6" class="w-8 h-7 rounded cursor-pointer bg-transparent">
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">åºå·é¢œè‰²</span>
            <input type="color" id="indexColor" value="#82869C" class="w-8 h-7 rounded cursor-pointer bg-transparent">
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">é«˜äº®èƒŒæ™¯</span>
            <input type="color" id="highlightBg" value="#7AA2F7" class="w-8 h-7 rounded cursor-pointer bg-transparent">
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">é«˜äº®æ–‡å­—</span>
            <input type="color" id="highlightText" value="#FFFFFF"
                class="w-8 h-7 rounded cursor-pointer bg-transparent">
        </div>
    </div>

    <!-- å¼•æ“ -->
    <h2 class="text-sm font-semibold text-purple bg-card rounded-lg px-3 py-1.5 mb-2 mt-4">ğŸ§  å¼•æ“</h2>
    <div class="space-y-0 divide-y divide-border">
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">å€™é€‰æ¨¡å¼</span>
            <select id="engineMode" class="bg-surface border border-border rounded-md px-2 py-1 text-sm text-slate-300">
                <option value="ai">AI ä¸»å¯¼</option>
                <option value="dict">å­—å…¸ä¸»å¯¼</option>
            </select>
        </div>
        <div class="flex items-center px-3 py-2 gap-3">
            <span class="flex-1 text-sm">AI å€™é€‰æ•° (top_k)</span>
            <input type="number" id="topK" min="1" max="9" value="5"
                class="w-16 bg-surface border border-border rounded-md px-2 py-1 text-center text-sm text-slate-300">
        </div>
        <label class="flex items-center px-3 py-2 gap-3 cursor-pointer">
            <span class="flex-1 text-sm">AI å‚ä¸æ’åº (rerank)</span>
            <input type="checkbox" id="rerank" checked class="w-4 h-4 accent-accent rounded">
        </label>
    </div>

    <!-- è¯åº“ -->
    <h2 class="text-sm font-semibold text-purple bg-card rounded-lg px-3 py-1.5 mb-2 mt-4">ğŸ“š è¯åº“</h2>
    <div id="dictSection" class="space-y-0 divide-y divide-border"></div>

    <!-- æ’ä»¶ -->
    <h2 class="text-sm font-semibold text-purple bg-card rounded-lg px-3 py-1.5 mb-2 mt-4">ğŸ”Œ JS æ’ä»¶</h2>
    <div id="pluginSection" class="space-y-0 divide-y divide-border">
        <div class="px-3 py-2 text-xs text-muted">plugins/ ç›®å½•ä¸‹æ— æ’ä»¶æ–‡ä»¶</div>
    </div>

    <!-- æ“ä½œæ  -->
    <div class="mt-6 flex justify-center items-center gap-3">
        <button onclick="window.ipc.postMessage(JSON.stringify({action:'cancel'}))"
            class="px-6 py-2 rounded-lg bg-card text-slate-300 hover:bg-border transition text-sm">å–æ¶ˆ</button>
        <button onclick="saveSettings()"
            class="px-6 py-2 rounded-lg bg-accent text-surface font-bold hover:bg-blue-400 transition text-sm">ğŸ’¾
            ä¿å­˜</button>
        <span id="status" class="text-xs text-green ml-3 hidden">âœ… å·²ä¿å­˜</span>
    </div>

    <script>
        const DICT_OPTIONS = [
            { id: 'sogou_it', name: 'ITè®¡ç®—æœº (3151æ¡)' },
            { id: 'sogou_city', name: 'åŸå¸‚ä¿¡æ¯ (10ä¸‡æ¡)' },
            { id: 'sogou_daily', name: 'æ—¥å¸¸ç”¨è¯­ (4560æ¡)' },
            { id: 'sogou_poem', name: 'å¤è¯—è¯ (39ä¸‡æ¡)' },
            { id: 'sogou_neologism', name: 'ç½‘ç»œæµè¡Œæ–°è¯ (1ä¸‡æ¡)' },
            { id: 'sogou_region', name: 'åŸå¸‚åœ°å (3563æ¡)' },
            { id: 'sogou_medical', name: 'åŒ»å­¦è¯æ±‡ (145æ¡)' },
            { id: 'sogou_food', name: 'é£Ÿç‰© (249æ¡)' },
            { id: 'sogou_idiom', name: 'æˆè¯­ (16æ¡)' },
        ];

        function renderDicts(enabled) {
            const el = document.getElementById('dictSection');
            el.innerHTML = DICT_OPTIONS.map(d => `
    <label class="flex items-center px-3 py-2 gap-3 cursor-pointer">
      <span class="flex-1 text-sm">${d.name}</span>
      <input type="checkbox" data-dict="${d.id}" ${enabled.includes(d.id) ? 'checked' : ''} class="w-4 h-4 accent-accent rounded">
    </label>
  `).join('');
        }

        function renderPlugins(plugins) {
            const el = document.getElementById('pluginSection');
            if (!plugins || plugins.length === 0) {
                el.innerHTML = '<div class="px-3 py-2 text-xs text-muted">plugins/ ç›®å½•ä¸‹æ— æ’ä»¶æ–‡ä»¶</div>';
                return;
            }
            el.innerHTML = plugins.map(p => `
    <div class="flex items-center px-3 py-2 gap-3">
      <input type="checkbox" ${p.enabled ? 'checked' : ''} onchange="togglePlugin('${p.name}', this.checked)" class="w-4 h-4 accent-accent rounded">
      <span class="flex-1 text-xs font-mono">${p.name}</span>
      <button onclick="deletePlugin('${p.name}')" class="px-2 py-0.5 rounded border border-red text-red text-xs hover:bg-red/10 transition">åˆ é™¤</button>
    </div>
  `).join('');
        }

        document.getElementById('opacity').addEventListener('input', function () {
            document.getElementById('opacityVal').textContent = this.value;
        });

        function saveSettings() {
            const checkboxes = document.querySelectorAll('[data-dict]:checked');
            const extra = Array.from(checkboxes).map(cb => cb.dataset.dict);
            const data = {
                action: 'save',
                config: {
                    engine_mode: document.getElementById('engineMode').value,
                    top_k: parseInt(document.getElementById('topK').value),
                    rerank: document.getElementById('rerank').checked,
                    opacity: parseInt(document.getElementById('opacity').value),
                    extra: extra,
                },
                style: {
                    font_size: document.getElementById('fontSize').value + 'px',
                    pinyin_size: document.getElementById('pinyinSize').value + 'px',
                    corner_radius: document.getElementById('cornerRadius').value + 'px',
                    bg_color: document.getElementById('bgColor').value,
                    text_color: document.getElementById('textColor').value,
                    pinyin_color: document.getElementById('pinyinColor').value,
                    index_color: document.getElementById('indexColor').value,
                    highlight_bg: document.getElementById('highlightBg').value,
                    highlight_text: document.getElementById('highlightText').value,
                },
            };
            window.ipc.postMessage(JSON.stringify(data));
            const s = document.getElementById('status');
            s.classList.remove('hidden');
            setTimeout(() => s.classList.add('hidden'), 2000);
        }

        function togglePlugin(name, enabled) {
            window.ipc.postMessage(JSON.stringify({ action: 'toggle_plugin', name, enabled }));
        }

        function deletePlugin(name) {
            if (confirm('ç¡®è®¤åˆ é™¤æ’ä»¶ ' + name + ' ï¼Ÿ')) {
                window.ipc.postMessage(JSON.stringify({ action: 'delete_plugin', name }));
                const items = document.querySelectorAll('.font-mono');
                items.forEach(el => { if (el.textContent === name) el.parentElement.remove(); });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (window.__INIT_CONFIG__) {
                const data = window.__INIT_CONFIG__;
                const c = data.config;
                const s = data.style;
                document.getElementById('engineMode').value = c.engine_mode || 'ai';
                document.getElementById('topK').value = c.top_k || 5;
                document.getElementById('rerank').checked = c.rerank !== false;
                document.getElementById('fontSize').value = parseInt(s.font_size) || 24;
                document.getElementById('pinyinSize').value = parseInt(s.pinyin_size) || 18;
                document.getElementById('cornerRadius').value = parseInt(s.corner_radius) || 14;
                document.getElementById('opacity').value = c.opacity || 240;
                document.getElementById('opacityVal').textContent = c.opacity || 240;
                document.getElementById('bgColor').value = s.bg_color || '#2E313E';
                document.getElementById('textColor').value = s.text_color || '#C8CCD8';
                document.getElementById('pinyinColor').value = s.pinyin_color || '#A9B1D6';
                document.getElementById('indexColor').value = s.index_color || '#82869C';
                document.getElementById('highlightBg').value = s.highlight_bg || '#7AA2F7';
                document.getElementById('highlightText').value = s.highlight_text || '#FFFFFF';
                renderDicts(c.extra || []);
                renderPlugins(data.plugins || []);
            }
        });
    </script>
</body>

</html>